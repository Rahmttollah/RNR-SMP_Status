<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RNR-SMP | Live</title>

<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Inter:wght@400;900&display=swap" rel="stylesheet">

<style>
:root{
    --bg:#050505;
    --card:#0f0f0f;
    --primary:#00ff88;
}

body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--bg);
    font-family:'Inter',sans-serif;
    color:#fff;
}

.card{
    width:90%;
    max-width:440px;
    padding:40px;
    border-radius:40px;
    background:var(--card);
    border:1px solid #222;
    text-align:center;
    box-shadow:0 0 50px rgba(0,255,136,.1);
}

.title-anim{
    font-size:3rem;
    font-weight:900;
    margin:0;
    background:linear-gradient(90deg,#00ff88,#00d2ff,#ff00ff,#00ff88);
    background-size:300% auto;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    animation:shine 4s linear infinite;
}
@keyframes shine{to{background-position:300% center}}

.player-count{
    font-size:4.5rem;
    font-weight:900;
    margin:10px 0;
}

.stats-grid{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:15px;
    margin-bottom:20px;
}

.stat-box{
    background:#181818;
    border:1px solid #222;
    padding:15px;
    border-radius:20px;
}

.stat-val{
    font-family:'JetBrains Mono';
    font-size:1.6rem;
}

.player-tag{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 12px;
    margin:4px;
    background:#1a1a1a;
    border:1px solid #333;
    border-radius:10px;
    font-size:.8rem;
}
.player-head{
    width:20px;
    height:20px;
    image-rendering:pixelated;
}

/* MOTD */
.motd-box{
    background:#000;
    border:1px solid #1a1a1a;
    padding:20px;
    border-radius:18px;
    margin-bottom:25px;
    font-family:'JetBrains Mono',monospace;
    text-align:center;
    white-space:pre-line;
}

.motd-line-1{
    font-size:1rem;
    font-weight:700;
}

.motd-line-2{
    font-size:.8rem;
    opacity:0;
    animation:fadeIn 1.2s ease forwards;
    animation-delay:.3s;
}
@keyframes fadeIn{
    from{opacity:0;transform:translateY(6px)}
    to{opacity:1;transform:translateY(0)}
}

/* OFFLINE */
.server-offline{
    color:#ff5555;
    font-weight:700;
    font-size:.95rem;
}

/* BADGES */
.server-uptime{
    margin-top:10px;
    font-size:.78rem;
    font-family:'JetBrains Mono';
    display:flex;
    justify-content:center;
    gap:8px;
    flex-wrap:wrap;
    opacity:0;
    animation:uptimeFade 1.2s ease forwards;
}
@keyframes uptimeFade{
    from{opacity:0;transform:translateY(6px)}
    to{opacity:1;transform:translateY(0)}
}

.badge{
    padding:3px 8px;
    border-radius:999px;
    font-weight:700;
    font-size:.72rem;
    border:1px solid #222;
    display:flex;
    align-items:center;
    gap:6px;
}

.badge img{
    width:16px;
    height:16px;
    image-rendering:pixelated;
    display:block;
}

.badge-uptime{
    color:#55ff55;
    background:rgba(85,255,85,.08);
}

.badge-version{
    color:#55ffff;
    background:rgba(85,255,255,.08);
}

.badge-java{
    color:#55aaff;
    background:rgba(85,170,255,.1);
}

.badge-pocket{
    color:#aa55ff;
    background:rgba(170,85,255,.1);
}

.ip-display{
    font-family:'JetBrains Mono';
    font-size:.85rem;
    color:#666;
    margin-bottom:10px;
}

.copy-btn{
    width:100%;
    padding:12px;
    border:none;
    border-radius:12px;
    font-weight:900;
    cursor:pointer;
}
</style>
</head>

<body>

<div class="card">
    <h1 class="title-anim">RNR-SMP</h1>

    <div id="player-val" class="player-count">--</div>

    <div class="stats-grid">
        <div class="stat-box">
            <div style="font-size:.6rem;color:#555">TPS</div>
            <div id="tps-val" class="stat-val" style="color:var(--primary)">20.0</div>
        </div>
        <div class="stat-box">
            <div style="font-size:.6rem;color:#555">Latency</div>
            <div id="ping-val" class="stat-val" style="color:#00d2ff">--</div>
        </div>
    </div>

    <div id="player-list"></div>

    <div id="motd-val" class="motd-box">Loading...</div>

    <div class="ip-display">RNR-SMP.aternos.me:29622</div>
    <button class="copy-btn" onclick="copyIP()">COPY IP</button>
</div>

<script>
const IP_ADDR="RNR-SMP.aternos.me:29622";
let motdRendered=false;
let offlineReloadTimer=null;

/* COLOR PARSER */
function parseMinecraftColors(text){
    if(!text) return "";
    const colors={
        '0':'#000','1':'#0000aa','2':'#00aa00','3':'#00aaaa',
        '4':'#aa0000','5':'#aa00aa','6':'#ffaa00','7':'#aaa',
        '8':'#555','9':'#5555ff','a':'#55ff55','b':'#55ffff',
        'c':'#ff5555','d':'#ff55ff','e':'#ffff55','f':'#fff'
    };
    let color='#fff',bold=false,italic=false,under=false,strike=false;
    let html="";
    for(let i=0;i<text.length;i++){
        if(text[i]==='¬ß' && i+1<text.length){
            const c=text[++i].toLowerCase();
            if(colors[c]) color=colors[c];
            else if(c==='l') bold=true;
            else if(c==='o') italic=true;
            else if(c==='n') under=true;
            else if(c==='m') strike=true;
            else if(c==='r'){color='#fff';bold=italic=under=strike=false;}
            continue;
        }
        let style=`color:${color};`;
        if(bold) style+='font-weight:bold;';
        if(italic) style+='font-style:italic;';
        if(under) style+='text-decoration:underline;';
        if(strike) style+='text-decoration:line-through;';
        html+=`<span style="${style}">${text[i]}</span>`;
    }
    return html;
}

/* UPDATE */
async function update(){
    try{
        const res=await fetch('/api/status');
        const data=await res.json();

        /* OFFLINE */
        if(!data.online){
            document.getElementById('player-val').innerText='--';
            document.getElementById('ping-val').innerText='--';
            document.getElementById('tps-val').innerText='--';

            document.getElementById('motd-val').innerHTML=
                `<div class="server-offline">üî¥ SERVER OFFLINE</div>`;

            motdRendered=false;

            if(!offlineReloadTimer){
                offlineReloadTimer=setInterval(()=>location.reload(),3000);
            }
            return;
        }

        /* STOP AUTO REFRESH WHEN ONLINE */
        if(offlineReloadTimer){
            clearInterval(offlineReloadTimer);
            offlineReloadTimer=null;
        }

        document.getElementById('player-val').innerText=
            `${data.players.online}/${data.players.max}`;
        document.getElementById('ping-val').innerText=data.latency+"ms";
        document.getElementById('tps-val').innerText=
            data.latency>200?(19.7+Math.random()*.2).toFixed(1):"20.0";

        document.getElementById('player-list').innerHTML=
            data.players.list.map(p=>`
                <div class="player-tag">
                    <img class="player-head"
                         src="https://mc-heads.net/avatar/${p.name}/20">
                    ${p.name}
                </div>
            `).join("");

        if(!motdRendered){
            let motdHTML='';
            if(data.motd[0]) motdHTML+=`<div class="motd-line-1">
                ${parseMinecraftColors(data.motd[0])}
            </div>`;
            if(data.motd[1]) motdHTML+=`<div class="motd-line-2">
                ${parseMinecraftColors(data.motd[1])}
            </div>`;

            motdHTML+=`
            <div class="server-uptime">
                <span class="badge badge-uptime">‚è± ${data.uptime}</span>
                <span class="badge badge-version">Version ${data.version}</span>

                <span class="badge badge-java">
                    <img src="https://i.supaimg.com/3631f333-bb2d-4007-82b9-0d823ed6407d.png">
                    Java
                </span>

                <span class="badge badge-pocket">
                    <img src="https://i.supaimg.com/0739e6ec-0921-4e3f-867e-6cccd8c30abd.jpg">
                    Pocket
                </span>
            </div>`;

            document.getElementById('motd-val').innerHTML=motdHTML;
            motdRendered=true;
        }

    }catch(e){}
}

function copyIP(){
    navigator.clipboard.writeText(IP_ADDR);
}

setInterval(update,1000);
update();
</script>

</body>
</html>
